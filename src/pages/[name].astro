---
import BaseLayout from "../layout/BaseLayout.astro";
import NotFound from "./not-found.astro";
import ChannelDetails from "../components/ChannelDetails.astro";
import Hero from '../components/Hero.astro'
const { params } = Astro;

// 1. Remove "-net-worth" from the end to get clean name
const cleanName = (params.name ?? "").replace(/-net-worth$/, "");

// 2. Build full fetch URL to your Worker API
const apiUrl = `https://channelincome-backend.ytincome.workers.dev/?channel=@${cleanName}`;

// 3. Fetch channel data
let data: any = null;
let isError = false;

try {
  const response = await fetch(apiUrl);
  data = await response.json();
  isError = !response.ok || !data || !data.title;
} catch (err) {
  console.error("Failed to fetch channel data:", err);
  isError = true;
}
---

<BaseLayout
  pageTitle={isError
    ? "Channel Not Found"
    : `${data.title} - YouTube Channel Stats`}
>
  {isError ? <NotFound /> : 
  <Hero>
  <ChannelDetails data={data} 
  </Hero>
  
  
  />}
</BaseLayout>
