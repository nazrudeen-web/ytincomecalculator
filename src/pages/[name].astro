---
import BaseLayout from "../layout/BaseLayout.astro";

const { params } = Astro;
const cleanName = params.name.replace(/-net-worth$/, "");
console.log(cleanName);
// Use full URL with origin, good for SSR
const siteOrigin = import.meta.env.PUBLIC_SITE_ORIGIN || "https://ytincomecalculator.pages.dev";

// Build correct API URL (remove extra '@' if not needed)
const apiUrl = new URL(`/api-channel?channel=${cleanName}`, siteOrigin).toString();

const res = await fetch(apiUrl);
const data = await res.json();

const isError = !res.ok || !data.title;
---

<BaseLayout pageTitle={isError ? "Channel Not Found" : `${data.title} - YouTube Channel Stats`}>
  {isError ? (
    <div>
      <h1>Channel not found</h1>
      <p>Please check the URL and try again.</p>
    </div>
  ) : (
    <div>
      <h1>{data.title}</h1>
      <img src={data.thumbnail} alt="Thumbnail" />
      <!-- other info here -->
    </div>
  )}
</BaseLayout>
